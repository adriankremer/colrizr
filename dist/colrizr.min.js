$(function(){var t=document.getElementById("picker"),a=t.getContext("2d"),e=new Image;e.onload=function(){a.drawImage(e,0,0,e.width,e.height)},e.src="../src/assets/skala.png";var o=document.getElementById("hidden-canvas"),c=o.getContext("2d"),r=new Image,g=null,n=null;r.src=$("#colrizr").attr("src"),r.onload=function(){o.width=r.width,o.height=r.height,c.drawImage(r,0,0,r.width,r.height),g=c.getImageData(0,0,r.width,r.height),n=c.getImageData(0,0,r.width,r.height)};var i,l,d=$("#picker");d.click(function(e){var o=$(t).offset(),c=Math.floor(e.pageX-o.left),r=Math.floor(e.pageY-o.top),g=a.getImageData(c,r,1,1);l=g.data,$(".active-color").css({"background-color":"rgb("+l[0]+","+l[1]+","+l[2]+")"}),i="rgb("+l[0]+","+l[1]+","+l[2]+")",$("#picker").mouseleave(function(){console.log(i),$(".active-color").css({"background-color":i})})});var h=0,s=0;d.on("touchstart",function(){}),d.on("touchmove",function(e){e.preventDefault();var o=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],c=$(t).offset(),r=Math.floor(o.pageX-c.left),g=Math.floor(o.pageY-c.top);h=e.originalEvent.touches[0].pageX,s=e.originalEvent.touches[0].pageY;var n=a.getImageData(r,g,1,1);l=n.data;var d=$(t).offset(),f=o.pageX-d.left,u=o.pageY-d.top;f<$(t).width()&&f>0&&u<$(t).height()&&u>0&&$(".active-color").css({"background-color":"rgb("+l[0]+","+l[1]+","+l[2]+")"}),i="rgb("+l[0]+","+l[1]+","+l[2]+")"}),d.mousemove(function(e){var o=$(t).offset(),c=Math.floor(e.pageX-o.left),r=Math.floor(e.pageY-o.top),g=a.getImageData(c,r,1,1),n=g.data;$(".active-color").css({"background-color":"rgb("+n[0]+","+n[1]+","+n[2]+")"})}),$(".active-color a").on("click",function(){for(var t=0,a=g.data.length;a>t;t+=4)n.data[t+3]>0&&(n.data[t]=g.data[t]/255*l[0],n.data[t+1]=g.data[t+1]/255*l[1],n.data[t+2]=g.data[t+2]/255*l[2]);c.putImageData(n,0,0),document.getElementById("colrizr").setAttribute("src",o.toDataURL())})});